package ru.rsreu.carservice.controller.actions;

import java.sql.SQLException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.apache.catalina.User;

import resources.Resourcer;
import ru.rsreu.carservice.controller.Action;
import ru.rsreu.carservice.model.bll.CarServiceBl;
import ru.rsreu.carservice.model.entities.Client;

public class LoginAction implements Action {
	
	private final static String LOGIN_PARAMETER_NAME = "login";
	private final static String PASSWORD_PARAMETER_NAME = "password";
	private final static String ERROR_LOGIN_PASSWORD_ATTRIBUTE = "errorLoginPassword";
	
	@Override
	public String execute(HttpServletRequest request, CarServiceBl carServiceBl) throws SQLException {
		String login = request.getParameter(LOGIN_PARAMETER_NAME);
		String password = request.getParameter(PASSWORD_PARAMETER_NAME);
		if (carServiceBl.checkAutentification(login, password)) {
			HttpSession session = request.getSession();
			session.setAttribute(LOGIN_PARAMETER_NAME, login);
			session.setAttribute(PASSWORD_PARAMETER_NAME, password);
			return Resourcer.getString("path.page.menu.admin");
		} else {
			request.setAttribute(ERROR_LOGIN_PASSWORD_ATTRIBUTE, Resourcer.getString("meassage.incorrect.login.password"));
			return Resourcer.getString("path.page.login");
		}
	}
	
	private Permission getPermission(String login, CarServiceBl carServiceBl) throws SQLException {
		Client client = carServiceBl.getClient(login);
		if (client != null) {
			return Permission.USER;
		}
		return Permission.ADMIN;
	}
}
