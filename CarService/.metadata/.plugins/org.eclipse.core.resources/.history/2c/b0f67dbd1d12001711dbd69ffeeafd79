package ru.rsreu.carservice.model.bll;

import java.sql.SQLException;
import java.util.Set;
import java.util.UUID;

import ru.rsreu.carservice.model.dal.CarServiceDao;
import ru.rsreu.carservice.model.dal.ICarServiceDao;
import ru.rsreu.carservice.model.entities.Car;
import ru.rsreu.carservice.model.entities.Client;
import ru.rsreu.carservice.model.entities.Order;
import ru.rsreu.carservice.model.entities.Password;
import ru.rsreu.carservice.model.entities.SharePart;
import ru.rsreu.carservice.model.entities.User;
import ru.rsreu.carservice.model.entities.Work;
import ru.rsreu.carservice.model.entities.Worker;

public class CarServiceBl {
	
	private ICarServiceDao carServiceDao;
	
	public CarServiceBl() throws SQLException {
		this.carServiceDao = new CarServiceDao();
	}
	
	public boolean checkAutentification(String login, String password) throws SQLException {
		User user = this.carServiceDao.readUser(login);
		if (user == null || password == null || password.isEmpty()) {
			return false;
		}
		int passwordHash = (password.hashCode() ^ user.getLogin().hashCode()) | password.hashCode();
		Password passwordEntity = this.carServiceDao.readPassword(passwordHash);
		return passwordEntity != null;
	}
	
	public void addAdminAccount(User user, String password) throws SQLException {
		int saultPasswordHash = (password.hashCode() ^ user.getLogin().hashCode()) | password.hashCode();
		Password passwordHash = new Password(saultPasswordHash);
		this.carServiceDao.addUser(user);
		this.carServiceDao.addPassword(passwordHash);
	}
	
	public void addClient(Client client, String password) throws SQLException {
		int saultPasswordHash = (password.hashCode() ^ client.getLogin().hashCode()) | password.hashCode();
		Password passwordHash = new Password(saultPasswordHash);
		this.carServiceDao.addClient(client);
		this.carServiceDao.addPassword(passwordHash);
	}
	
	public void addWorker(Worker worker, String password) throws SQLException {
		int saultPasswordHash = (password.hashCode() ^ worker.getLogin().hashCode()) | password.hashCode();
		Password passwordHash = new Password(saultPasswordHash);
		this.carServiceDao.addWorker(worker);
		this.carServiceDao.addPassword(passwordHash);
	}
	
	public Permission getPermission(String login) throws Exception {
		User user = this.carServiceDao.readUser(login);
		if (user == null) {
			throw new Exception("No access rights.");
		}
		Client client = this.carServiceDao.readClient(login);
		if (client != null) {
			return Permission.CLIENT;
		}
		return Permission.ADMIN;
	}
	
	public void addOrder(Order order) throws SQLException {
		this.carServiceDao.addOrder(order);
	}
	
	public void addWork(Work work) throws SQLException {
		this.carServiceDao.addWork(work);
	}
	
	public void addSharePart(SharePart sharePart) throws SQLException {
		this.carServiceDao.addSharePart(sharePart);
	}
	
	public void addCar(Car car) throws SQLException {
		this.carServiceDao.addCar(car);
	}
	
	public void addOrderWorkers(Order order, Set<Worker> workers) throws SQLException {
		for (Worker worker : workers)
		this.carServiceDao.addOrderWorker(order, worker);
	}
 	
	public User getUser(String login) throws SQLException {
		return this.carServiceDao.readUser(login);
	}
	
	public Set<Order> getAllOrders() throws SQLException {
		return this.carServiceDao.readAllOrders();
	}
	
	public Set<Client> getAllClients() throws SQLException {
		return this.carServiceDao.readAllClients();
	}
	
	public Set<Worker> getAllWorkers() throws SQLException {
		return this.carServiceDao.readAllWorkers();
	}
	
	public Set<SharePart> getAllShareParts() throws SQLException {
		return this.carServiceDao.readAllShareParts();
	}
	
	public Set<Work> getAllWorks() throws SQLException {
		return this.carServiceDao.readAllWorks();
	}
	
	public Set<Car> getClientCars(Client client) throws SQLException {
		return this.carServiceDao.readClientCars(client);
	}
	
	public Set<Worker> getFreeWorkers() throws SQLException {
		return this.carServiceDao.readFreeWorkers();
	}
	
	public Set<Worker> getOrderWorkers(Order order) throws SQLException {
		return this.carServiceDao.readOrderWorkers(order);
	}
	
	public Client getClient(String login) throws SQLException {
		return this.carServiceDao.readClient(login);
	}
	
	public Worker getWorker(String login) throws SQLException {
		return this.carServiceDao.readWorker(login);
	}
	
	public Worker getWorker(UUID workerGuid) throws SQLException {
		return this.carServiceDao.readWorker(workerGuid);
	}
	
	public Set<Order> getClientOrders(Client client) throws SQLException {
		return this.carServiceDao.readClientOrders(client);
	}
	
	public void updateWorker(Worker worker) throws SQLException {
		this.carServiceDao.updateWorker(worker);
	}
	
	public void updateWork(Work work) throws SQLException {
		this.carServiceDao.updateWork(work);
	}
	
	public void updateSharePart(SharePart sharePart) throws SQLException {
		this.carServiceDao.updateSharePart(sharePart);
	}
	
	public void updateClient(Client client) throws SQLException {
		this.carServiceDao.updateClient(client);
	}
	
	
	public void deleteAccount(User user) throws SQLException {
		this.carServiceDao.deleteUser(user);
	}
	
	public void deleteUser(User user) throws SQLException {
		this.carServiceDao.deleteUser(user);
	}
	
	public void deleteOrderWorkers(Order order, Set<Worker> workers) throws SQLException {
		for (Worker worker : workers) {
			this.carServiceDao.deleteOrderWorker(order, worker);
		}
	}
	
	public void deleteWork(Work work) throws SQLException {
		this.carServiceDao.deleteWork(work);
	}
	
	public void deleteSharePart(SharePart sharePart) throws SQLException {
		this.carServiceDao.deleteSharePart(sharePart);
	}
	
	public void deleteCar(Car car) throws SQLException {
		this.carServiceDao.deleteCar(car);
	}
	
	public void deleteOrder(Order order) throws SQLException {
		this.carServiceDao.deleteOrder(order);
	}
}
