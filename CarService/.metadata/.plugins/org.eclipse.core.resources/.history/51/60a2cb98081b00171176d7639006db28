package ru.rsreu.carservice.controller;

import java.sql.SQLException;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpSession;
import javax.servlet.http.HttpSessionAttributeListener;
import javax.servlet.http.HttpSessionBindingEvent;
import javax.servlet.http.HttpSessionEvent;
import javax.servlet.http.HttpSessionListener;

import resources.Resourcer;
import ru.rsreu.carservice.model.bll.CarService;
import ru.rsreu.carservice.model.entities.User;

public class SessionListener implements HttpSessionAttributeListener {

	@Override
	public void attributeAdded(HttpSessionBindingEvent sessionBindingEvent) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void attributeRemoved(HttpSessionBindingEvent sessionBindingEvent) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void attributeReplaced(HttpSessionBindingEvent sessionBindingEvent) {
		// TODO Auto-generated method stub
		
	}
	
	private void setUserStatus(HttpSessionEvent sessionEvent, boolean isOnline) {
		HttpSession session = sessionEvent.getSession();
		ServletContext context = session.getServletContext();
		CarService carService = (CarService) context.getAttribute(Resourcer.getString("parameter.carservice"));
		String login = session.getAttribute(Resourcer.getString("parameter.user.login")).toString();
		try {
			User user = carService.getUser(login);
			user.setIsOnline(isOnline);
			carService.updateUser(user);
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
}
