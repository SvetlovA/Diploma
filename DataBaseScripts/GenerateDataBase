-- Generated by Oracle SQL Developer Data Modeler 3.1.4.710
--   at:        2017-04-03 00:35:58 MSK
--   site:      Oracle Database 11g
--   type:      Oracle Database 11g



CREATE TABLE Cars 
    ( 
     CarId INTEGER  NOT NULL , 
     CarGuid VARCHAR2 (40)  NOT NULL , 
     ClientId INTEGER  NOT NULL , 
     StateNumber NVARCHAR2 (50)  NOT NULL , 
     Mark NVARCHAR2 (50)  NOT NULL , 
     Model NVARCHAR2 (50)  NOT NULL 
    ) 
;



ALTER TABLE Cars 
    ADD CONSTRAINT Cars_PK PRIMARY KEY ( CarId ) ;


ALTER TABLE Cars 
    ADD CONSTRAINT Cars_Number_UN UNIQUE ( StateNumber ) ;


ALTER TABLE Cars 
    ADD CONSTRAINT Cars_CarGuid_UN UNIQUE ( CarGuid ) ;



CREATE TABLE Clients 
    ( 
     ClientId INTEGER  NOT NULL , 
     Surname NVARCHAR2 (50)  NOT NULL , 
     Name NVARCHAR2 (50)  NOT NULL , 
     Patronymic NVARCHAR2 (50)  NOT NULL 
    ) 
;



ALTER TABLE Clients 
    ADD CONSTRAINT Clients_PK PRIMARY KEY ( ClientId ) ;



CREATE TABLE Orders 
    ( 
     OrderId INTEGER  NOT NULL , 
     OrderGuid VARCHAR2 (40)  NOT NULL , 
     OrderDate DATE  NOT NULL , 
     CarId INTEGER  NOT NULL , 
     TotalCost REAL DEFAULT 0 
     CONSTRAINT Default_TotalCost NOT NULL , 
     Status NVARCHAR2 (50) DEFAULT 'NotStarted' 
     CONSTRAINT Default_Status NOT NULL 
    ) 
;



ALTER TABLE Orders 
    ADD CONSTRAINT Orders_PK PRIMARY KEY ( OrderId ) ;


ALTER TABLE Orders 
    ADD CONSTRAINT Orders_OrderGuid_UN UNIQUE ( OrderGuid ) ;



CREATE TABLE OrdersShareParts 
    ( 
     OrderId INTEGER  NOT NULL , 
     SharePartId INTEGER  NOT NULL 
    ) 
;



ALTER TABLE OrdersShareParts 
    ADD CONSTRAINT OrdersShareParts_PK PRIMARY KEY ( SharePartId, OrderId ) ;



CREATE TABLE OrdersWorkers 
    ( 
     OrderId INTEGER  NOT NULL , 
     WorkerId INTEGER  NOT NULL 
    ) 
;



ALTER TABLE OrdersWorkers 
    ADD CONSTRAINT OrdersWorkers_PK PRIMARY KEY ( WorkerId, OrderId ) ;



CREATE TABLE OrdersWorks 
    ( 
     OrderId INTEGER  NOT NULL , 
     WorkId INTEGER  NOT NULL 
    ) 
;



ALTER TABLE OrdersWorks 
    ADD CONSTRAINT OrdersWorks_PK PRIMARY KEY ( OrderId, WorkId ) ;



CREATE TABLE Passwords 
    ( 
     PasswordHash INTEGER  NOT NULL 
    ) 
;



ALTER TABLE Passwords 
    ADD CONSTRAINT Passwords_PK PRIMARY KEY ( PasswordHash ) ;



CREATE TABLE ShareParts 
    ( 
     SharePartId INTEGER  NOT NULL , 
     SharePartGuid VARCHAR2 (40)  NOT NULL , 
     Name NVARCHAR2 (50)  NOT NULL , 
     Price REAL  NOT NULL , 
     Count INTEGER DEFAULT 0 , 
     Description NVARCHAR2 (50) 
    ) 
;



ALTER TABLE ShareParts 
    ADD CONSTRAINT ShareParts_PK PRIMARY KEY ( SharePartId ) ;


ALTER TABLE ShareParts 
    ADD CONSTRAINT ShareParts_SharePartGuid_UN UNIQUE ( SharePartGuid ) ;



CREATE TABLE Users 
    ( 
     UserId INTEGER  NOT NULL , 
     UserGuid VARCHAR2 (40)  NOT NULL , 
     Login NVARCHAR2 (50)  NOT NULL 
    ) 
;



ALTER TABLE Users 
    ADD CONSTRAINT Users_PK PRIMARY KEY ( UserId ) ;


ALTER TABLE Users 
    ADD CONSTRAINT Users_Login_UN UNIQUE ( Login ) ;


ALTER TABLE Users 
    ADD CONSTRAINT Users_UserGuid_UN UNIQUE ( UserGuid ) ;



CREATE TABLE Workers 
    ( 
     WorkerId INTEGER  NOT NULL , 
     Surname NVARCHAR2 (50)  NOT NULL , 
     Name NVARCHAR2 (50)  NOT NULL , 
     Patronymic NVARCHAR2 (50)  NOT NULL , 
     Experience INTEGER  NOT NULL 
    ) 
;



ALTER TABLE Workers 
    ADD CONSTRAINT Workers_PK PRIMARY KEY ( WorkerId ) ;



CREATE TABLE Works 
    ( 
     WorkId INTEGER  NOT NULL , 
     WorkGuid VARCHAR2 (40)  NOT NULL , 
     Name NVARCHAR2 (50)  NOT NULL , 
     Price REAL  NOT NULL , 
     Description NVARCHAR2 (250) 
    ) 
;



ALTER TABLE Works 
    ADD CONSTRAINT Works_PK PRIMARY KEY ( WorkId ) ;


ALTER TABLE Works 
    ADD CONSTRAINT Works_WorkGuid_UN UNIQUE ( WorkGuid ) ;




ALTER TABLE Cars 
    ADD CONSTRAINT Cars_Clients_FK FOREIGN KEY 
    ( 
     ClientId
    ) 
    REFERENCES Clients 
    ( 
     ClientId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE Clients 
    ADD CONSTRAINT Clients_Users_FK FOREIGN KEY 
    ( 
     ClientId
    ) 
    REFERENCES Users 
    ( 
     UserId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE OrdersShareParts 
    ADD CONSTRAINT OrdersShareParts_Orders_FK FOREIGN KEY 
    ( 
     OrderId
    ) 
    REFERENCES Orders 
    ( 
     OrderId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE OrdersShareParts 
    ADD CONSTRAINT OrdersShareParts_ShareParts_FK FOREIGN KEY 
    ( 
     SharePartId
    ) 
    REFERENCES ShareParts 
    ( 
     SharePartId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE OrdersWorkers 
    ADD CONSTRAINT OrdersWorkers_Orders_FK FOREIGN KEY 
    ( 
     OrderId
    ) 
    REFERENCES Orders 
    ( 
     OrderId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE OrdersWorkers 
    ADD CONSTRAINT OrdersWorkers_Workers_FK FOREIGN KEY 
    ( 
     WorkerId
    ) 
    REFERENCES Workers 
    ( 
     WorkerId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE OrdersWorks 
    ADD CONSTRAINT OrdersWorks_Orders_FK FOREIGN KEY 
    ( 
     OrderId
    ) 
    REFERENCES Orders 
    ( 
     OrderId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE OrdersWorks 
    ADD CONSTRAINT OrdersWorks_Works_FK FOREIGN KEY 
    ( 
     WorkId
    ) 
    REFERENCES Works 
    ( 
     WorkId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE Orders 
    ADD CONSTRAINT Orders_Cars_FK FOREIGN KEY 
    ( 
     CarId
    ) 
    REFERENCES Cars 
    ( 
     CarId
    ) 
    ON DELETE CASCADE 
;


ALTER TABLE Workers 
    ADD CONSTRAINT Workers_Users_FK FOREIGN KEY 
    ( 
     WorkerId
    ) 
    REFERENCES Users 
    ( 
     UserId
    ) 
    ON DELETE CASCADE 
;

CREATE SEQUENCE Cars_CarId_SEQ 
    NOCACHE 
    ORDER ;

CREATE OR REPLACE TRIGGER Cars_CarId_TRG 
BEFORE INSERT ON Cars 
FOR EACH ROW 
WHEN (NEW.CarId IS NULL) 
BEGIN 
    SELECT Cars_CarId_SEQ.NEXTVAL INTO :NEW.CarId FROM DUAL; 
END;
/

CREATE SEQUENCE Orders_OrderId_SEQ 
    NOCACHE 
    ORDER ;

CREATE OR REPLACE TRIGGER Orders_OrderId_TRG 
BEFORE INSERT ON Orders 
FOR EACH ROW 
WHEN (NEW.OrderId IS NULL) 
BEGIN 
    SELECT Orders_OrderId_SEQ.NEXTVAL INTO :NEW.OrderId FROM DUAL; 
END;
/

CREATE SEQUENCE ShareParts_SharePartId_SEQ 
    NOCACHE 
    ORDER ;

CREATE OR REPLACE TRIGGER ShareParts_SharePartId_TRG 
BEFORE INSERT ON ShareParts 
FOR EACH ROW 
WHEN (NEW.SharePartId IS NULL) 
BEGIN 
    SELECT ShareParts_SharePartId_SEQ.NEXTVAL INTO :NEW.SharePartId FROM DUAL; 
END;
/

CREATE SEQUENCE Users_UserId_SEQ 
    NOCACHE 
    ORDER ;

CREATE OR REPLACE TRIGGER Users_UserId_TRG 
BEFORE INSERT ON Users 
FOR EACH ROW 
WHEN (NEW.UserId IS NULL) 
BEGIN 
    SELECT Users_UserId_SEQ.NEXTVAL INTO :NEW.UserId FROM DUAL; 
END;
/

CREATE SEQUENCE Works_WorkId_SEQ 
    NOCACHE 
    ORDER ;

CREATE OR REPLACE TRIGGER Works_WorkId_TRG 
BEFORE INSERT ON Works 
FOR EACH ROW 
WHEN (NEW.WorkId IS NULL) 
BEGIN 
    SELECT Works_WorkId_SEQ.NEXTVAL INTO :NEW.WorkId FROM DUAL; 
END;
/



-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                            11
-- CREATE INDEX                             0
-- ALTER TABLE                             28
-- CREATE VIEW                              0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           5
-- ALTER TRIGGER                            0
-- CREATE STRUCTURED TYPE                   0
-- CREATE COLLECTION TYPE                   0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          5
-- CREATE MATERIALIZED VIEW                 0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0
